# 📘 Kubernetes 기본 학습 정리

---

## 🚀 Kubernetes란?
컨테이너 오케스트레이션 도구로, **여러 서버(노드)에 분산된 컨테이너를 자동으로 생성·배치·관리**한다.  
시스템 전체를 통합적으로 관리하며, 사용자가 정의한 상태(Desired State)를 항상 유지하려고 한다.

- 컨테이너 오케스트레이션 = "컨테이너 관리 자동화"
- 원하는 상태를 **매니페스트(YAML)** 파일로 정의
- 쿠버네티스는 이를 `etcd`에 저장하고, 항상 실제 상태를 바람직한 상태로 맞춘다

---

## 🔑 K8s
- `kubernetes`의 축약형  
- `k`와 `s` 사이에 8글자가 있어 **k8s**라고 부른다  

---

## 🖥️ 클러스터 구조

### 🧠 Control Plane (마스터 노드)

쿠버네티스 클러스터의 **두뇌 역할**을 담당하는 부분으로,  
클러스터 전체 상태를 관리하고 워커 노드를 제어한다.  
컨테이너를 직접 실행하지 않고, 오직 **관리 기능**에 집중한다.

👉 **마스터 노드 내부에는 컨트롤 플레인 컴포넌트들이 존재하며,  
이 컴포넌트들이 클러스터를 제어한다.**  
즉, **마스터 노드 = 컨트롤 플레인을 실행하는 노드**라고 이해하면 된다.

#### 컨트롤 플레인 주요 구성 요소
- **kube-apiserver**  
  - 클러스터와 통신하는 유일한 관문  
  - 사용자가 `kubectl`로 보낸 요청을 받아들이고, 내부 컴포넌트에 전달한다  

- **kube-controller-manager**  
  - 리소스(파드, 디플로이먼트 등)의 실제 상태를 감시  
  - 매니페스트에 정의된 "원하는 상태(Desired State)"로 항상 맞춰준다  
  - 예: 파드 5개를 유지하도록 선언했는데 1개가 죽으면 → 다시 1개를 생성해 5개로 복구  

- **kube-scheduler**  
  - 새 파드를 어느 워커 노드에 배치할지 결정  
  - 노드의 리소스 사용량(CPU/메모리), 레이블, 어피니티 등을 고려해 최적의 노드를 선택  

- **etcd**  
  - 분산 Key-Value 저장소  
  - 클러스터의 모든 설정과 상태(메타데이터)를 영속적으로 저장  
  - 쿠버네티스의 “Single Source of Truth(유일한 진실 저장소)”  

- **cloud-controller-manager**  
  - 클라우드 환경(AWS, GCP, Azure 등)과 연동  
  - 노드 관리, 로드밸런서 생성, 스토리지 프로비저닝 등 클라우드 종속 기능을 처리  

---

### Worker Node (워커 노드)
컨테이너가 실제로 실행되는 곳. 파드(Pod)와 볼륨이 동작한다.

구성 요소:
- **kube-let**:  
  마스터의 스케줄러와 통신. 파드 생성/삭제 및 컨테이너 상태 관리.
- **kube-proxy**:  
  네트워크 프록시. 서비스와 파드 간 통신, 로드밸런싱 처리.
- **Container Runtime** (예: Docker, containerd, CRI-O):  
  실제 컨테이너를 실행하는 엔진.
- **CNI 플러그인**:  
  Pod-to-Pod, Node-to-Node 네트워킹을 위해 필요.  
  예: Flannel, Calico, WeaveNet

---

### 🌐 쿠버네티스 네트워킹 (CNI)

쿠버네티스 자체에는 네트워크 기능이 내장되어 있지 않다.  
대신 **CNI(Container Network Interface)** 라는 표준 인터페이스를 제공하고,  
실제 구현은 외부 **네트워크 플러그인**이 담당한다.

#### 📌 CNI의 역할
- Pod ↔ Pod 간 통신 (같은 노드 / 다른 노드)
- Pod ↔ 외부 네트워크 연결
- 네트워크 정책(NetworkPolicy) 적용

#### 📦 대표적인 CNI 플러그인
- **Flannel**: 가장 간단한 오버레이 네트워크
- **Calico**: 네트워크 + 보안 정책(네트워크 폴리시) 지원
- **Weave Net**: 설치 간단, 자동 네트워크 메쉬 구성
- **Cilium**: eBPF 기반 고성능 네트워킹 및 보안

---


## ⚙️ 쿠버네티스의 핵심 원리
- **Desired State 유지**  
  - 매니페스트 파일에서 정의된 바람직한 상태를 `etcd`에 저장  
  - 실제 상태가 달라지면 → 컨트롤러가 감지 → 자동으로 수정  
  - 예: 파드 5개가 설정돼 있는데 1개를 수동 삭제하면 → 다시 5개가 되도록 복구  

- **자가치유(Self-healing)**  
  - 쿠버네티스가 항상 올바른 상태로 맞추려는 특징  

---
